<!DOCTYPE html>
<html>
	<head>
	</head>
	<link href="https://fonts.googleapis.com/css2?family=Blinker:wght@300;600&display=swap" rel="stylesheet">
	<style>
		html, body {
			height: 100%;
		}

		body { 
			margin: 0;
		}

		canvas {
			width: 100%;
			height: 100%;
		}
	</style>
	<body>
		<canvas id="mainCanvas"></canvas>

		<script>
			if(!(localStorage.getItem('nickname') && localStorage.getItem('skin'))) {
				window.location = '/join/' + location.pathname.substr(1);
			}
		</script>

		<script src="/socket.io/socket.io.js"></script>
		<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
		<script>
			var canvas = document.getElementById('mainCanvas');
			var ctx = canvas.getContext('2d');

			canvas.width = window.innerWidth;
			canvas.height = window.innerHeight;
			window.addEventListener('resize', function() {
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight;
			})
		</script>
		<script>
			var socket = io({transports: ['websocket']});
			socket.emit('registerPlayer', {
				room: location.pathname.substr(1),
				nickname: localStorage.getItem('nickname'),
				skin: localStorage.getItem('skin')
			});

			var room = {
				players: [],
				min: 0,
				max: 0
			};
			socket.on('updateRoom', function(rm) {
				room.players = [];
				for(let i = 0; i<rm.players.length; i++) {
					let dataURL = rm.players[i].skin;
					let skin = new Image;
					skin.src = dataURL;
					
					room.players.push({
						nickname: rm.players[i].nickname,
						skin: skin
					});
				}

				room.min = rm.min;
				room.max = rm.max;
			})
		</script>
		<script src="/waitingRoom.js"></script>
	</body>
</html>